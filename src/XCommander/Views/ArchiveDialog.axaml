<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="using:XCommander.Controls"
             xmlns:vm="using:XCommander.ViewModels"
             x:Class="XCommander.Views.ArchiveDialog"
             x:DataType="vm:ArchiveViewModel"
             MinWidth="800"
             MinHeight="500">
    <Grid RowDefinitions="Auto,Auto,*,Auto,Auto" Margin="10">
        <!-- Header -->
        <controls:TcBevelPanel Grid.Row="0" Padding="6,4">
            <Grid ColumnDefinitions="Auto,*">
                <TextBlock Text="Archive:" FontWeight="SemiBold" Margin="0,0,6,0"/>
                <TextBlock Grid.Column="1" Text="{Binding ArchiveName}" FontWeight="Bold"/>
            </Grid>
        </controls:TcBevelPanel>

        <!-- Toolbar -->
        <controls:TcBevelPanel Grid.Row="1" Padding="6,4" Margin="0,6,0,0">
            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="6">
                    <Button Content="Up" Command="{Binding NavigateToCommand}"
                            CommandParameter="{Binding Entries[0]}"
                            IsEnabled="{Binding CurrentPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                            MinWidth="60"/>
                    <TextBlock Text="Path:" VerticalAlignment="Center" Margin="6,0,4,0"/>
                    <TextBlock Text="{Binding CurrentPath}" VerticalAlignment="Center"
                               FontFamily="{DynamicResource MonoFontFamily}"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Spacing="6">
                    <Button Content="Add Files" Command="{Binding RequestAddFilesCommand}"
                            IsEnabled="{Binding !IsOperationInProgress}"/>
                    <Button Content="Delete" Command="{Binding DeleteSelectedFromArchiveCommand}"
                            IsEnabled="{Binding !IsOperationInProgress}"/>
                    <TextBlock Text="|" VerticalAlignment="Center" Foreground="{DynamicResource TcMutedTextBrush}" Margin="4,0"/>
                    <Button Content="Extract All" Click="ExtractAll_Click"
                            IsEnabled="{Binding !IsOperationInProgress}"/>
                    <Button Content="Extract Selected" Click="ExtractSelected_Click"
                            IsEnabled="{Binding !IsOperationInProgress}"/>
                    <Button Content="Test" Command="{Binding TestArchiveCommand}"
                            IsEnabled="{Binding !IsOperationInProgress}"/>
                    <Button Content="Cancel" Command="{Binding CancelCommand}"
                            IsEnabled="{Binding IsOperationInProgress}"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                            Orientation="Horizontal" Spacing="6" Margin="0,6,0,0">
                    <Button Content="Select All" Command="{Binding SelectAllCommand}" Width="80"/>
                    <Button Content="Select None" Command="{Binding SelectNoneCommand}" Width="90"/>
                    <TextBlock Text="|" VerticalAlignment="Center" Foreground="{DynamicResource TcMutedTextBrush}" Margin="6,0"/>
                    <TextBlock VerticalAlignment="Center">
                        <Run Text="Files: "/>
                        <Run Text="{Binding FileCount}" FontWeight="Bold"/>
                        <Run Text=" | Folders: "/>
                        <Run Text="{Binding FolderCount}" FontWeight="Bold"/>
                        <Run Text=" | Size: "/>
                        <Run Text="{Binding TotalSizeDisplay}" FontWeight="Bold"/>
                        <Run Text=" â†’ "/>
                        <Run Text="{Binding TotalCompressedSizeDisplay}" FontWeight="Bold"/>
                        <Run Text=" ("/>
                        <Run Text="{Binding CompressionRatioDisplay}" FontWeight="Bold"/>
                        <Run Text=" saved)"/>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </controls:TcBevelPanel>

        <!-- File List -->
        <controls:TcInsetPanel Grid.Row="2" Padding="0" Margin="0,6,0,0">
            <DataGrid ItemsSource="{Binding Entries}"
                      ColumnDefinitionsSource="{Binding ColumnDefinitions}"
                      FilteringModel="{Binding FilteringModel}"
                      SortingModel="{Binding SortingModel}"
                      SearchModel="{Binding SearchModel}"
                      AutoGenerateColumns="False"
                      CanUserReorderColumns="True"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      SelectionMode="Extended"
                      IsReadOnly="True"
                      GridLinesVisibility="Horizontal"
                      BorderThickness="0"
                      Margin="0"
                      DoubleTapped="DataGrid_DoubleTapped">
                <DataGrid.FastPathOptions>
                    <DataGridFastPathOptions UseAccessorsOnly="True"
                                             ThrowOnMissingAccessor="True" />
                </DataGrid.FastPathOptions>
            </DataGrid>
        </controls:TcInsetPanel>

        <!-- Progress -->
        <controls:TcBevelPanel Grid.Row="3" Padding="6,4" Margin="0,6,0,0"
                               IsVisible="{Binding IsOperationInProgress}">
            <ProgressBar Value="{Binding Progress}" Minimum="0" Maximum="100" Height="4"/>
        </controls:TcBevelPanel>

        <!-- Status Bar -->
        <controls:TcBevelPanel Grid.Row="4" Padding="6,4" Margin="0,6,0,0">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding Status}" VerticalAlignment="Center"/>
                <Button Grid.Column="1" Content="Close" Click="Close_Click" Width="80"/>
            </Grid>
        </controls:TcBevelPanel>
    </Grid>
</UserControl>
