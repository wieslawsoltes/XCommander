<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="using:XCommander.Controls"
        xmlns:vm="using:XCommander.ViewModels"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="700"
        x:Class="XCommander.Views.MultiRenameDialog"
        x:DataType="vm:MultiRenameViewModel"
        Title="Multi-Rename Tool"
        Width="950"
        Height="700"
        WindowStartupLocation="CenterOwner">

    <Window.Resources>
        <DataTemplate x:Key="RenameItemNewNameTemplate"
                      x:DataType="vm:RenameItem">
            <TextBlock Text="{Binding NewName}"
                       Margin="4,0"
                       VerticalAlignment="Center">
                <TextBlock.Foreground>
                    <MultiBinding Converter="{x:Static BoolConverters.Or}">
                        <Binding Path="HasConflict"/>
                        <Binding Path="HasError"/>
                    </MultiBinding>
                </TextBlock.Foreground>
            </TextBlock>
        </DataTemplate>
        <DataTemplate x:Key="RenameItemStatusTemplate"
                      x:DataType="vm:RenameItem">
            <StackPanel Orientation="Horizontal" Margin="4,0">
                <TextBlock Text="Conflict"
                           IsVisible="{Binding HasConflict}"
                           Foreground="Orange"/>
                <TextBlock Text="Error"
                           IsVisible="{Binding HasError}"
                           Foreground="Red"
                           ToolTip.Tip="{Binding ErrorMessage}"/>
                <TextBlock Text="Done"
                           IsVisible="{Binding IsRenamed}"
                           Foreground="Green"/>
            </StackPanel>
        </DataTemplate>
        <DataTemplate x:Key="RenameItemActionsTemplate"
                      x:DataType="vm:RenameItem">
            <StackPanel Orientation="Horizontal" Spacing="2">
                <Button Content="Up"
                        Command="{Binding $parent[Window].((vm:MultiRenameViewModel)DataContext).MoveItemUpCommand}"
                        CommandParameter="{Binding}"
                        Padding="4,2"
                        FontSize="10"/>
                <Button Content="Down"
                        Command="{Binding $parent[Window].((vm:MultiRenameViewModel)DataContext).MoveItemDownCommand}"
                        CommandParameter="{Binding}"
                        Padding="4,2"
                        FontSize="10"/>
                <Button Content="Remove"
                        Command="{Binding $parent[Window].((vm:MultiRenameViewModel)DataContext).RemoveItemCommand}"
                        CommandParameter="{Binding}"
                        Padding="4,2"
                        FontSize="10"/>
            </StackPanel>
        </DataTemplate>
    </Window.Resources>
    
    <Grid RowDefinitions="Auto,*,Auto" Margin="10">
        <!-- Settings Panel -->
        <controls:TcBevelPanel Grid.Row="0" Padding="6,4" Margin="0,0,0,6">
            <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto">
                <!-- Search & Replace -->
                <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto,*" Margin="0,0,0,8">
                    <TextBlock Grid.Column="0" Text="Search:" VerticalAlignment="Center" Width="80"/>
                    <TextBox Grid.Column="1" Text="{Binding SearchPattern}" Watermark="Text to find"/>
                    <TextBlock Grid.Column="2" Text="Replace:" VerticalAlignment="Center" Margin="20,0,8,0"/>
                    <TextBox Grid.Column="3" Text="{Binding ReplacePattern}" Watermark="Replacement text or pattern"/>
                </Grid>
                
                <!-- Options -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="15" Margin="0,0,0,8">
                    <CheckBox IsChecked="{Binding UseRegex}" Content="Regular expressions"/>
                    <CheckBox IsChecked="{Binding CaseSensitive}" Content="Case sensitive"/>
                </StackPanel>
                
                <!-- Extension & Counter -->
                <Grid Grid.Row="2" ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" Margin="0,0,0,8">
                    <TextBlock Grid.Column="0" Text="Extension:" VerticalAlignment="Center" Width="80"/>
                    <TextBox Grid.Column="1" Text="{Binding ExtensionPattern}" Width="80" Watermark=".ext"/>
                    
                    <TextBlock Grid.Column="2" Text="Counter start:" VerticalAlignment="Center" Margin="20,0,8,0"/>
                    <TextBox Grid.Column="3" Text="{Binding CounterStart}" Width="60"/>
                    
                    <TextBlock Grid.Column="4" Text="Step:" VerticalAlignment="Center" Margin="10,0,8,0"/>
                    <TextBox Grid.Column="5" Text="{Binding CounterStep}" Width="50"/>
                    
                    <TextBlock Grid.Column="6" Text="Digits:" VerticalAlignment="Center" Margin="10,0,8,0"/>
                    <TextBox Grid.Column="7" Text="{Binding CounterDigits}" Width="50"/>
                </Grid>
                
                <!-- Case Transform -->
                <Grid Grid.Row="3" ColumnDefinitions="Auto,Auto,Auto,Auto" Margin="0,0,0,8">
                    <TextBlock Grid.Column="0" Text="Name case:" VerticalAlignment="Center" Width="80"/>
                    <ComboBox Grid.Column="1" SelectedIndex="{Binding NameCase}" Width="120">
                        <ComboBoxItem Content="No change"/>
                        <ComboBoxItem Content="lowercase"/>
                        <ComboBoxItem Content="UPPERCASE"/>
                        <ComboBoxItem Content="Title Case"/>
                        <ComboBoxItem Content="Sentence case"/>
                    </ComboBox>
                    
                    <TextBlock Grid.Column="2" Text="Extension case:" VerticalAlignment="Center" Margin="20,0,8,0"/>
                    <ComboBox Grid.Column="3" SelectedIndex="{Binding ExtensionCase}" Width="120">
                        <ComboBoxItem Content="No change"/>
                        <ComboBoxItem Content="lowercase"/>
                        <ComboBoxItem Content="UPPERCASE"/>
                        <ComboBoxItem Content="Title Case"/>
                        <ComboBoxItem Content="Sentence case"/>
                    </ComboBox>
                </Grid>
                
                <!-- Placeholders Help -->
                <Expander Grid.Row="4" Header="Placeholders Reference" IsExpanded="False">
                    <TextBlock FontFamily="{DynamicResource MonoFontFamily}" FontSize="11" Opacity="0.8">
                        <Run Text="[N] = Original name    [N1-5] = Characters 1-5    [E] = Extension    [C] = Counter"/>
                        <LineBreak/>
                        <Run Text="[D] = Date (yyyyMMdd)  [T] = Time (HHmmss)    [Y] = Year         [M] = Month"/>
                        <LineBreak/>
                        <Run Text="[Dx] = Day             [H] = Hour             [m] = Minute       [s] = Second"/>
                    </TextBlock>
                </Expander>
            </Grid>
        </controls:TcBevelPanel>
        
        <!-- File List -->
        <controls:TcInsetPanel Grid.Row="1" Padding="0">
            <DataGrid ItemsSource="{Binding Items}"
                      ColumnDefinitionsSource="{Binding ItemColumnDefinitions}"
                      FilteringModel="{Binding ItemFilteringModel}"
                      SortingModel="{Binding ItemSortingModel}"
                      SearchModel="{Binding ItemSearchModel}"
                      SelectionMode="Extended"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      GridLinesVisibility="Horizontal"
                      IsReadOnly="True"
                      BorderThickness="0"
                      FontSize="12">
                <DataGrid.FastPathOptions>
                    <DataGridFastPathOptions UseAccessorsOnly="True"
                                             ThrowOnMissingAccessor="True" />
                </DataGrid.FastPathOptions>
            </DataGrid>
        </controls:TcInsetPanel>
        
        <!-- Bottom Bar -->
        <controls:TcBevelPanel Grid.Row="2" Padding="6,4" Margin="0,6,0,0">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Undo Controls -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                    <Button Content="Undo Last" 
                            Command="{Binding UndoLastRenameCommand}"
                            Padding="8,4"/>
                    <Button Content="History" 
                            Click="OnShowHistoryClick"
                            Padding="8,4"/>
                </StackPanel>
                
                <!-- Status -->
                <TextBlock Grid.Column="1" 
                           VerticalAlignment="Center"
                           Margin="16,0">
                    <Run Text="{Binding Items.Count}"/>
                    <Run Text=" files selected"/>
                </TextBlock>
                
                <!-- Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="6">
                    <Button Content="Reset" 
                            Command="{Binding ResetCommand}"
                            Padding="10,4"/>
                    <Button Content="Preview" 
                            Command="{Binding UpdatePreviewCommand}"
                            Padding="10,4"/>
                    <Button Content="Start" 
                            Command="{Binding ExecuteRenameCommand}"
                            Padding="10,4"/>
                    <Button Content="Close" 
                            Click="OnCloseClick"
                            Padding="10,4"/>
                </StackPanel>
            </Grid>
        </controls:TcBevelPanel>
    </Grid>
    
    <Window.KeyBindings>
        <KeyBinding Gesture="Escape" Command="{Binding $parent[Window].Close}"/>
    </Window.KeyBindings>
</Window>
