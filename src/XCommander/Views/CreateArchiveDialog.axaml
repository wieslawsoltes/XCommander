<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="using:XCommander.Controls"
             xmlns:vm="using:XCommander.ViewModels"
             x:Class="XCommander.Views.CreateArchiveDialog"
             x:DataType="vm:CreateArchiveViewModel"
             MinWidth="600"
             MinHeight="400">
    <UserControl.Resources>
        <DataTemplate x:Key="CreateArchiveActionTemplate"
                      x:DataType="vm:FileToArchive">
            <Button Content="âœ•"
                    Command="{Binding $parent[DataGrid].((vm:CreateArchiveViewModel)DataContext).RemoveFileCommand}"
                    CommandParameter="{Binding}"
                    Padding="4,2"
                    ToolTip.Tip="Remove from archive"/>
        </DataTemplate>
    </UserControl.Resources>

    <Grid RowDefinitions="Auto,Auto,*,Auto,Auto" Margin="10">
        <controls:TcBevelPanel Grid.Row="0" Padding="6,4">
            <TextBlock Text="Create Archive" FontWeight="Bold"/>
        </controls:TcBevelPanel>

        <controls:TcBevelPanel Grid.Row="1" Padding="6,4" Margin="0,6,0,0">
            <Grid RowDefinitions="Auto,Auto,Auto">
                <Grid Grid.Row="0" ColumnDefinitions="100,*,Auto" Margin="0,0,0,6">
                    <TextBlock Text="Archive:" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1" Text="{Binding ArchivePath}"
                             IsEnabled="{Binding !IsCreating}" Margin="0,0,6,0"/>
                    <Button Grid.Column="2" Content="..." Width="30" Click="BrowsePath_Click"
                            IsEnabled="{Binding !IsCreating}"/>
                </Grid>

                <Grid Grid.Row="1" ColumnDefinitions="100,Auto,100,Auto" Margin="0,0,0,6">
                    <TextBlock Text="Type:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Column="1" ItemsSource="{Binding ArchiveTypes}"
                              SelectedItem="{Binding SelectedType}"
                              IsEnabled="{Binding !IsCreating}"
                              Width="120"/>
                    <TextBlock Grid.Column="2" Text="Compression:" VerticalAlignment="Center" Margin="12,0,0,0"/>
                    <ComboBox Grid.Column="3" ItemsSource="{Binding CompressionLevels}"
                              SelectedItem="{Binding SelectedCompressionLevel}"
                              IsEnabled="{Binding !IsCreating}"
                              Width="120"/>
                </Grid>

                <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12">
                    <TextBlock VerticalAlignment="Center">
                        <Run Text="Files: "/>
                        <Run Text="{Binding Files.Count}" FontWeight="Bold"/>
                    </TextBlock>
                    <TextBlock VerticalAlignment="Center">
                        <Run Text="Total size: "/>
                        <Run Text="{Binding TotalSizeDisplay}" FontWeight="Bold"/>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </controls:TcBevelPanel>

        <controls:TcInsetPanel Grid.Row="2" Padding="0" Margin="0,6,0,0">
            <DataGrid ItemsSource="{Binding Files}"
                      AutoGenerateColumns="False"
                      ColumnDefinitionsSource="{Binding ColumnDefinitions}"
                      FilteringModel="{Binding FilteringModel}"
                      SortingModel="{Binding SortingModel}"
                      SearchModel="{Binding SearchModel}"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      SelectionMode="Single"
                      IsReadOnly="True"
                      GridLinesVisibility="Horizontal"
                      BorderThickness="0"
                      Margin="0">
                <DataGrid.FastPathOptions>
                    <DataGridFastPathOptions UseAccessorsOnly="True"
                                             ThrowOnMissingAccessor="True" />
                </DataGrid.FastPathOptions>
            </DataGrid>
        </controls:TcInsetPanel>

        <controls:TcBevelPanel Grid.Row="3" Padding="6,4" Margin="0,6,0,0"
                               IsVisible="{Binding IsCreating}">
            <ProgressBar Value="{Binding Progress}" Minimum="0" Maximum="100" Height="4"/>
        </controls:TcBevelPanel>

        <controls:TcBevelPanel Grid.Row="4" Padding="6,4" Margin="0,6,0,0">
            <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                <TextBlock Text="{Binding Status}" VerticalAlignment="Center"/>
                <Button Grid.Column="1" Content="Create" Command="{Binding CreateCommand}"
                        IsEnabled="{Binding !IsCreating}"
                        Width="80" Margin="0,0,6,0"/>
                <Button Grid.Column="2" Content="Cancel" Command="{Binding CancelCommand}"
                        IsEnabled="{Binding IsCreating}"
                        Width="80" Margin="0,0,6,0"/>
                <Button Grid.Column="3" Content="Close" Click="Close_Click" Width="80"/>
            </Grid>
        </controls:TcBevelPanel>
    </Grid>
</UserControl>
