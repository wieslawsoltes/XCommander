<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="using:XCommander.Controls"
             xmlns:vm="using:XCommander.ViewModels"
             x:Class="XCommander.Views.DirectoryCompareDialog"
             x:DataType="vm:DirectoryCompareViewModel"
             MinWidth="900"
             MinHeight="600">
    <Grid RowDefinitions="Auto,Auto,*,Auto,Auto" Margin="10">
        <controls:TcBevelPanel Grid.Row="0" Padding="6,4">
            <TextBlock Text="Directory Comparison" FontWeight="Bold"/>
        </controls:TcBevelPanel>

        <!-- Options -->
        <controls:TcBevelPanel Grid.Row="1" Padding="6,4" Margin="0,6,0,0">
            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="Auto,*,Auto,Auto,*,Auto">
                <!-- Left Directory -->
                <TextBlock Grid.Row="0" Grid.Column="0" Text="Left:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding LeftPath}" 
                         IsEnabled="{Binding !IsComparing}" Margin="0,0,4,8"/>
                <Button Grid.Row="0" Grid.Column="2" Content="..." Width="30" Margin="0,0,16,8"
                        IsEnabled="{Binding !IsComparing}" Click="BrowseLeft_Click"/>

                <!-- Right Directory -->
                <TextBlock Grid.Row="0" Grid.Column="3" Text="Right:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <TextBox Grid.Row="0" Grid.Column="4" Text="{Binding RightPath}" 
                         IsEnabled="{Binding !IsComparing}" Margin="0,0,4,8"/>
                <Button Grid.Row="0" Grid.Column="5" Content="..." Width="30" Margin="0,0,0,8"
                        IsEnabled="{Binding !IsComparing}" Click="BrowseRight_Click"/>

                <!-- Options Row -->
                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="6" Orientation="Horizontal" Spacing="12" Margin="0,0,0,6">
                    <CheckBox Content="Show only differences" IsChecked="{Binding ShowOnlyDifferences}" IsEnabled="{Binding !IsComparing}"/>
                    <CheckBox Content="Compare subdirectories" IsChecked="{Binding CompareSubdirectories}" IsEnabled="{Binding !IsComparing}"/>
                    <CheckBox Content="Compare by content" IsChecked="{Binding CompareByContent}" IsEnabled="{Binding !IsComparing}"/>
                    <CheckBox Content="Compare by date" IsChecked="{Binding CompareByDate}" IsEnabled="{Binding !IsComparing}"/>
                    <CheckBox Content="Compare by size" IsChecked="{Binding CompareBySize}" IsEnabled="{Binding !IsComparing}"/>
                    <CheckBox Content="Ignore case" IsChecked="{Binding IgnoreCase}" IsEnabled="{Binding !IsComparing}"/>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="6" Orientation="Horizontal" Spacing="6">
                    <Button Content="Compare" Command="{Binding CompareCommand}" IsEnabled="{Binding !IsComparing}"/>
                    <Button Content="Cancel" Command="{Binding CancelCommand}" IsEnabled="{Binding IsComparing}"/>
                    <TextBlock Text="|" VerticalAlignment="Center" Foreground="{DynamicResource TcMutedTextBrush}" Margin="6,0"/>
                    <Button Content="Copy → Right" Command="{Binding CopyToRightCommand}" IsEnabled="{Binding !IsComparing}" ToolTip.Tip="Copy selected files from left to right"/>
                    <Button Content="Copy ← Left" Command="{Binding CopyToLeftCommand}" IsEnabled="{Binding !IsComparing}" ToolTip.Tip="Copy selected files from right to left"/>
                    <TextBlock Text="|" VerticalAlignment="Center" Foreground="{DynamicResource TcMutedTextBrush}" Margin="6,0"/>
                    <Button Content="Select All" Command="{Binding SelectAllCommand}"/>
                    <Button Content="Select None" Command="{Binding SelectNoneCommand}"/>
                    <Button Content="Left Only" Command="{Binding SelectLeftOnlyCommand}"/>
                    <Button Content="Right Only" Command="{Binding SelectRightOnlyCommand}"/>
                    <Button Content="Different" Command="{Binding SelectDifferentCommand}"/>
                </StackPanel>
            </Grid>
        </controls:TcBevelPanel>

        <!-- Results Grid -->
        <controls:TcInsetPanel Grid.Row="2" Padding="0" Margin="0,6,0,0">
            <DataGrid ItemsSource="{Binding ResultsView}"
                      ColumnDefinitionsSource="{Binding ColumnDefinitions}"
                      FilteringModel="{Binding FilteringModel}"
                      SortingModel="{Binding SortingModel}"
                      SearchModel="{Binding SearchModel}"
                      AutoGenerateColumns="False"
                      CanUserReorderColumns="True"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      GridLinesVisibility="All"
                      IsReadOnly="False"
                      BorderThickness="0">
                <DataGrid.FastPathOptions>
                    <DataGridFastPathOptions UseAccessorsOnly="True"
                                             ThrowOnMissingAccessor="True" />
                </DataGrid.FastPathOptions>
            </DataGrid>
        </controls:TcInsetPanel>

        <!-- Statistics -->
        <controls:TcBevelPanel Grid.Row="3" Padding="6,4" Margin="0,6,0,0">
            <StackPanel Orientation="Horizontal" Spacing="24">
                <TextBlock>
                    <Run Text="Left only: "/>
                    <Run Text="{Binding LeftOnlyCount}" FontWeight="Bold" Foreground="Blue"/>
                </TextBlock>
                <TextBlock>
                    <Run Text="Right only: "/>
                    <Run Text="{Binding RightOnlyCount}" FontWeight="Bold" Foreground="Green"/>
                </TextBlock>
                <TextBlock>
                    <Run Text="Different: "/>
                    <Run Text="{Binding DifferentCount}" FontWeight="Bold" Foreground="Red"/>
                </TextBlock>
                <TextBlock>
                    <Run Text="Identical: "/>
                    <Run Text="{Binding IdenticalCount}" FontWeight="Bold" Foreground="Gray"/>
                </TextBlock>
            </StackPanel>
        </controls:TcBevelPanel>

        <!-- Status Bar -->
        <controls:TcBevelPanel Grid.Row="4" Padding="6,4" Margin="0,6,0,0">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding Status}" VerticalAlignment="Center"/>
                <Button Grid.Column="1" Content="Close" Click="Close_Click" Width="80"/>
            </Grid>
        </controls:TcBevelPanel>
    </Grid>
</UserControl>
