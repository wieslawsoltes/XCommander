<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="using:XCommander.Controls"
        xmlns:vm="using:XCommander.ViewModels"
        mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="500"
        x:Class="XCommander.Views.FileAssociationsDialog"
        x:DataType="vm:FileAssociationManager"
        Title="File Associations"
        Width="900"
        Height="600"
        WindowStartupLocation="CenterOwner">
    
    <Grid RowDefinitions="Auto,*,Auto" Margin="10">
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,6">
            <TextBlock Text="File Associations"
                       FontWeight="Bold"
                       FontSize="14"/>
            <TextBlock Text="Configure custom viewers and editors for different file types. Use %s as placeholder for file path." 
                       Foreground="{DynamicResource TcMutedTextBrush}"
                       FontSize="12"
                       TextWrapping="Wrap"
                       Margin="0,2,0,0"/>
        </StackPanel>
        
        <!-- Content -->
        <Grid Grid.Row="1" ColumnDefinitions="*,300" ColumnSpacing="8">
            <!-- Associations List -->
            <controls:TcInsetPanel Grid.Column="0" Padding="0">
                <DataGrid ItemsSource="{Binding Associations}"
                          SelectedItem="{Binding SelectedAssociation}"
                          AutoGenerateColumns="False"
                          ColumnDefinitionsSource="{Binding ColumnDefinitions}"
                          FilteringModel="{Binding FilteringModel}"
                          SortingModel="{Binding SortingModel}"
                          SearchModel="{Binding SearchModel}"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          IsReadOnly="False"
                          SelectionMode="Single"
                          BorderThickness="0"
                          GridLinesVisibility="Horizontal"
                          FontSize="12">
                    <DataGrid.FastPathOptions>
                        <DataGridFastPathOptions UseAccessorsOnly="True"
                                                 ThrowOnMissingAccessor="True" />
                    </DataGrid.FastPathOptions>
                </DataGrid>
            </controls:TcInsetPanel>
            
            <!-- Edit Panel -->
            <controls:TcInsetPanel Grid.Column="1" Padding="10">
                <StackPanel IsEnabled="{Binding SelectedAssociation, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <TextBlock Text="Edit Association" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    
                    <TextBlock Text="Extension:" FontSize="12" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding SelectedAssociation.Extension}" Margin="0,0,0,10"/>
                    
                    <TextBlock Text="Description:" FontSize="12" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding SelectedAssociation.Description}" Margin="0,0,0,10"/>
                    
                    <CheckBox Content="Use System Default" 
                              IsChecked="{Binding SelectedAssociation.UseSystemDefault}"
                              Margin="0,0,0,10"/>
                    
                    <TextBlock Text="View Command:" FontSize="12" Margin="0,0,0,4"
                               IsEnabled="{Binding !SelectedAssociation.UseSystemDefault}"/>
                    <TextBox Text="{Binding SelectedAssociation.ViewerCommand}" 
                             Watermark="e.g., notepad &quot;%s&quot;"
                             IsEnabled="{Binding !SelectedAssociation.UseSystemDefault}"
                             Margin="0,0,0,10"/>
                    
                    <TextBlock Text="Edit Command:" FontSize="12" Margin="0,0,0,4"
                               IsEnabled="{Binding !SelectedAssociation.UseSystemDefault}"/>
                    <TextBox Text="{Binding SelectedAssociation.EditorCommand}" 
                             Watermark="e.g., code &quot;%s&quot;"
                             IsEnabled="{Binding !SelectedAssociation.UseSystemDefault}"
                             Margin="0,0,0,10"/>
                    
                    <TextBlock Text="Open Command (double-click):" FontSize="12" Margin="0,0,0,4"
                               IsEnabled="{Binding !SelectedAssociation.UseSystemDefault}"/>
                    <TextBox Text="{Binding SelectedAssociation.OpenCommand}" 
                             Watermark="e.g., internal:archive"
                             IsEnabled="{Binding !SelectedAssociation.UseSystemDefault}"
                             Margin="0,0,0,10"/>
                    
                    <Button Content="Remove" 
                            Command="{Binding RemoveAssociationCommand}"
                            CommandParameter="{Binding SelectedAssociation}"
                            HorizontalAlignment="Left"
                            Padding="12,6"
                            Margin="0,10,0,0"/>
                </StackPanel>
            </controls:TcInsetPanel>
        </Grid>
        
        <!-- Buttons -->
        <controls:TcBevelPanel Grid.Row="2" Padding="6,4" Margin="0,6,0,0">
        <Grid ColumnDefinitions="Auto,*,Auto">
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                <TextBox Text="{Binding NewExtension}" 
                         Watermark=".ext" 
                         Width="80"/>
                <Button Content="Add Extension" 
                        Command="{Binding AddAssociationCommand}"
                        Padding="10,4"/>
                <Button Content="Reset Defaults" 
                        Command="{Binding ResetToDefaultsCommand}"
                        Padding="10,4"/>
            </StackPanel>
            
            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                <Button Content="Save" 
                        Click="OnSaveClick"
                        Padding="10,4"/>
                <Button Content="Cancel" 
                        Click="OnCancelClick"
                        Padding="10,4"/>
            </StackPanel>
        </Grid>
        </controls:TcBevelPanel>
    </Grid>
    
    <Window.KeyBindings>
        <KeyBinding Gesture="Escape" Command="{Binding $parent[Window].Close}"/>
    </Window.KeyBindings>
</Window>
