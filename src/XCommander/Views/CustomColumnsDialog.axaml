<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:XCommander.ViewModels"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="450"
             x:Class="XCommander.Views.CustomColumnsDialog"
             x:DataType="vm:CustomColumnsViewModel">
    
    <Grid RowDefinitions="Auto,*,Auto,Auto">
        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                Padding="16">
            <StackPanel>
                <TextBlock Text="Custom Columns" FontSize="20" FontWeight="SemiBold"/>
                <TextBlock Text="Configure which columns are displayed and their order" 
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                           Margin="0,4,0,0"/>
            </StackPanel>
        </Border>
        
        <!-- Content -->
        <Grid Grid.Row="1" ColumnDefinitions="*,Auto,*" Margin="16">
            <!-- Active Columns -->
            <Grid RowDefinitions="Auto,*">
                <TextBlock Text="Active Columns" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <Border Grid.Row="1" BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                        BorderThickness="1" CornerRadius="4">
                    <ListBox ItemsSource="{Binding Columns}"
                             SelectedItem="{Binding SelectedColumn}"
                             Background="Transparent">
                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="vm:ColumnConfigItemViewModel">
                                <Grid ColumnDefinitions="Auto,*,Auto" Margin="4,2">
                                    <CheckBox Grid.Column="0" 
                                              IsChecked="{Binding IsVisible}"
                                              IsEnabled="{Binding Id, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                              Command="{Binding $parent[UserControl].((vm:CustomColumnsViewModel)DataContext).ToggleColumnVisibilityCommand}"
                                              CommandParameter="{Binding}"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Name}" 
                                               VerticalAlignment="Center" Margin="8,0"/>
                                    <TextBlock Grid.Column="2" Text="{Binding Width, StringFormat={}{0}px}" 
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               FontSize="11"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>
            </Grid>
            
            <!-- Move Buttons -->
            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="8" Spacing="4">
                <Button Content="▲" Command="{Binding MoveColumnUpCommand}" 
                        ToolTip.Tip="Move Up" Width="32"/>
                <Button Content="▼" Command="{Binding MoveColumnDownCommand}" 
                        ToolTip.Tip="Move Down" Width="32"/>
                <Separator Margin="0,8"/>
                <Button Content="←" Command="{Binding AddColumnCommand}" 
                        ToolTip.Tip="Add Column" Width="32"/>
                <Button Content="→" Command="{Binding RemoveColumnCommand}" 
                        ToolTip.Tip="Remove Column" Width="32"/>
            </StackPanel>
            
            <!-- Available Columns -->
            <Grid Grid.Column="2" RowDefinitions="Auto,*">
                <TextBlock Text="Available Columns" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <Border Grid.Row="1" BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                        BorderThickness="1" CornerRadius="4">
                    <ListBox ItemsSource="{Binding AvailableColumns}"
                             SelectedItem="{Binding SelectedAvailableColumn}"
                             Background="Transparent">
                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="vm:ColumnConfigItemViewModel">
                                <TextBlock Text="{Binding Name}" Margin="8,4"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>
            </Grid>
        </Grid>
        
        <!-- Column Properties -->
        <Border Grid.Row="2" Margin="16,0,16,16" Padding="16" 
                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                CornerRadius="4"
                IsVisible="{Binding SelectedColumn, Converter={x:Static ObjectConverters.IsNotNull}}">
            <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto,*" RowDefinitions="Auto,Auto">
                <TextBlock Text="Column Width:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <NumericUpDown Grid.Column="1" Value="{Binding SelectedColumn.Width}" 
                               Minimum="30" Maximum="500" Increment="10"
                               FormatString="0" Width="100"/>
                
                <TextBlock Grid.Column="2" Text="Alignment:" VerticalAlignment="Center" Margin="24,0,8,0"/>
                <ComboBox Grid.Column="3" SelectedIndex="0" Width="100">
                    <ComboBoxItem Content="Left"/>
                    <ComboBoxItem Content="Center"/>
                    <ComboBoxItem Content="Right"/>
                </ComboBox>
            </Grid>
        </Border>
        
        <!-- Button Bar -->
        <Border Grid.Row="3" Padding="16" Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <Button Content="Reset to Default" Command="{Binding ResetToDefaultCommand}"/>
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                    <Button Content="OK" Click="OnOkClick" Width="80"/>
                    <Button Content="Cancel" Click="OnCancelClick" Width="80"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
