<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="using:XCommander.Controls"
        xmlns:vm="using:XCommander.ViewModels"
        xmlns:sys="clr-namespace:System;assembly=System.Runtime"
        mc:Ignorable="d"
        Width="640"
        Height="520"
        x:Class="XCommander.Views.Dialogs.CopyMoveDialog"
        x:DataType="vm:CopyMoveDialogViewModel"
        Title="{Binding DialogTitle}"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        ShowInTaskbar="False">

    <Window.Resources>
        <DataTemplate x:Key="SourcePathTemplate"
                      x:DataType="sys:String">
            <TextBlock Text="{Binding}" Margin="6,2" TextTrimming="CharacterEllipsis"/>
        </DataTemplate>
    </Window.Resources>

    <Grid RowDefinitions="Auto,Auto,*,Auto" Margin="10">
        <!-- Source -->
        <StackPanel Grid.Row="0" Spacing="6">
            <TextBlock Text="{Binding DialogTitle}" FontWeight="Bold" FontSize="14"/>
            <TextBlock Text="{Binding SourceDescription}"
                       FontSize="11"
                       Foreground="{DynamicResource TcMutedTextBrush}"/>
            <controls:TcInsetPanel Padding="0" Margin="0,2,0,0">
                <DataGrid ItemsSource="{Binding SourcePaths}"
                          ColumnDefinitionsSource="{Binding SourcePathColumnDefinitions}"
                          FilteringModel="{Binding SourcePathFilteringModel}"
                          SortingModel="{Binding SourcePathSortingModel}"
                          SearchModel="{Binding SourcePathSearchModel}"
                          BorderThickness="0"
                          Background="Transparent"
                          MinHeight="40"
                          MaxHeight="70"
                          HeadersVisibility="None"
                          GridLinesVisibility="None"
                          IsReadOnly="True">
                    <DataGrid.FastPathOptions>
                        <DataGridFastPathOptions UseAccessorsOnly="True"
                                                 ThrowOnMissingAccessor="True" />
                    </DataGrid.FastPathOptions>
                </DataGrid>
            </controls:TcInsetPanel>
        </StackPanel>

        <!-- Destination -->
        <StackPanel Grid.Row="1" Margin="0,8,0,0" Spacing="4">
            <TextBlock Text="Destination:"/>
            <Grid ColumnDefinitions="*,Auto,Auto">
                <ComboBox Grid.Column="0"
                          IsEditable="True"
                          Text="{Binding DestinationPath, Mode=TwoWay}"
                          ItemsSource="{Binding RecentDestinations}"
                          HorizontalAlignment="Stretch"/>
                <Button Grid.Column="1"
                        Content="Browse..."
                        Command="{Binding BrowseDestinationCommand}"
                        Margin="6,0,0,0"
                        MinWidth="80"/>
                <Button Grid.Column="2"
                        Content="Swap"
                        Command="{Binding SwapSourceDestinationCommand}"
                        Margin="6,0,0,0"
                        MinWidth="60"/>
            </Grid>
        </StackPanel>

        <!-- Options -->
        <Grid Grid.Row="2" Margin="0,8,0,0" ColumnDefinitions="*,*" ColumnSpacing="8">
            <StackPanel Grid.Column="0" Spacing="8">
                <Border BorderBrush="{DynamicResource TcBorderMidBrush}"
                        BorderThickness="1"
                        Background="{DynamicResource TcWindowBackgroundBrush}"
                        Padding="8">
                    <StackPanel Spacing="4">
                        <TextBlock Text="Overwrite" FontWeight="SemiBold"/>
                        <RadioButton Content="Ask before overwriting"
                                     IsChecked="{Binding OverwriteMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:OverwriteMode.Ask}}"
                                     GroupName="OverwriteMode"/>
                        <RadioButton Content="Overwrite all without asking"
                                     IsChecked="{Binding OverwriteMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:OverwriteMode.OverwriteAll}}"
                                     GroupName="OverwriteMode"/>
                        <RadioButton Content="Overwrite only if source is newer"
                                     IsChecked="{Binding OverwriteMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:OverwriteMode.OverwriteOlder}}"
                                     GroupName="OverwriteMode"/>
                        <RadioButton Content="Skip existing files"
                                     IsChecked="{Binding OverwriteMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:OverwriteMode.SkipExisting}}"
                                     GroupName="OverwriteMode"/>
                        <RadioButton Content="Rename automatically (add number)"
                                     IsChecked="{Binding OverwriteMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:OverwriteMode.RenameAuto}}"
                                     GroupName="OverwriteMode"/>
                        <RadioButton Content="Resume partial transfers"
                                     IsChecked="{Binding OverwriteMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static vm:OverwriteMode.Resume}}"
                                     GroupName="OverwriteMode"/>
                    </StackPanel>
                </Border>

                <Border BorderBrush="{DynamicResource TcBorderMidBrush}"
                        BorderThickness="1"
                        Background="{DynamicResource TcWindowBackgroundBrush}"
                        Padding="8">
                    <StackPanel Spacing="4">
                        <TextBlock Text="Preserve and copy" FontWeight="SemiBold"/>
                        <CheckBox Content="Preserve date/time stamps"
                                  IsChecked="{Binding PreserveDateTime}"/>
                        <CheckBox Content="Preserve file attributes"
                                  IsChecked="{Binding PreserveAttributes}"/>
                        <CheckBox Content="Copy empty directories"
                                  IsChecked="{Binding CopyEmptyDirectories}"/>
                        <CheckBox Content="Copy system and hidden files"
                                  IsChecked="{Binding CopySystemAndHidden}"/>
                    </StackPanel>
                </Border>
            </StackPanel>

            <StackPanel Grid.Column="1" Spacing="8">
                <Border BorderBrush="{DynamicResource TcBorderMidBrush}"
                        BorderThickness="1"
                        Background="{DynamicResource TcWindowBackgroundBrush}"
                        Padding="8">
                    <StackPanel Spacing="4">
                        <TextBlock Text="Additional" FontWeight="SemiBold"/>
                        <CheckBox Content="Verify after copy"
                                  IsChecked="{Binding VerifyAfterCopy}"
                                  IsVisible="{Binding IsCopyOperation}"/>
                        <CheckBox Content="Use fast move (same volume only)"
                                  IsChecked="{Binding UseFastMove}"
                                  IsVisible="{Binding IsMoveOperation}"/>
                        <CheckBox Content="Use background transfer (queue)"
                                  IsChecked="{Binding UseBackgroundTransfer}"/>
                        <CheckBox Content="Low CPU priority"
                                  IsChecked="{Binding LowPriority}"/>
                        <CheckBox Content="Follow symbolic links"
                                  IsChecked="{Binding FollowSymlinks}"/>
                        <CheckBox Content="Create relative symlinks"
                                  IsChecked="{Binding CreateRelativeSymlinks}"/>
                        <CheckBox Content="Keep partial files on error"
                                  IsChecked="{Binding KeepPartialOnError}"/>
                    </StackPanel>
                </Border>

                <Border BorderBrush="{DynamicResource TcBorderMidBrush}"
                        BorderThickness="1"
                        Background="{DynamicResource TcWindowBackgroundBrush}"
                        Padding="8">
                    <StackPanel Spacing="6">
                        <TextBlock Text="Filters" FontWeight="SemiBold"/>
                        <Grid ColumnDefinitions="Auto,8,*" RowDefinitions="Auto,6,Auto">
                            <TextBlock Grid.Row="0" Grid.Column="0"
                                       Text="Include:"
                                       VerticalAlignment="Center"/>
                            <TextBox Grid.Row="0" Grid.Column="2"
                                     Text="{Binding IncludeFilter}"
                                     Watermark="*.* (all files)"/>
                            <TextBlock Grid.Row="2" Grid.Column="0"
                                       Text="Exclude:"
                                       VerticalAlignment="Center"/>
                            <TextBox Grid.Row="2" Grid.Column="2"
                                     Text="{Binding ExcludeFilter}"
                                     Watermark="e.g., *.tmp;*.bak"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- Summary + Buttons -->
        <Grid Grid.Row="3" Margin="0,8,0,0" ColumnDefinitions="*,Auto" VerticalAlignment="Center">
            <controls:TcBevelPanel Padding="6,4" HorizontalAlignment="Left">
                <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">
                    <TextBlock Grid.Column="0" Text="Files:" Margin="0,0,4,0"/>
                    <TextBlock Grid.Column="1" Text="{Binding SelectedFilesCount}" Margin="0,0,12,0"/>
                    <TextBlock Grid.Column="2" Text="Folders:" Margin="0,0,4,0"/>
                    <TextBlock Grid.Column="3" Text="{Binding SelectedFoldersCount}" Margin="0,0,12,0"/>
                    <TextBlock Grid.Column="4" Text="Size:" Margin="0,0,4,0"/>
                    <TextBlock Grid.Column="5" Text="{Binding TotalSizeFormatted}"/>
                </Grid>
            </controls:TcBevelPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="6" HorizontalAlignment="Right">
                <Button Content="{Binding ActionButtonText}"
                        Command="{Binding ConfirmCommand}"
                        IsDefault="True"
                        MinWidth="80"/>
                <Button Content="Queue"
                        Command="{Binding QueueCommand}"
                        ToolTip.Tip="Add to background transfer queue"
                        MinWidth="80"/>
                <Button Content="Cancel"
                        Command="{Binding CancelCommand}"
                        IsCancel="True"
                        MinWidth="80"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
